### Pioneer for iOS 测试	

​	Pioneer for iOS 的目的是设计出耗电量低、CPU 占用低、存储占用低的能够在后台持续运行的、适用范围广的联系人跟踪应用。该测试模块基于 Pioneer for iOS 在 iPhone 上的测试数据，给出 Pioneer 应用在正常的工作模式下的功耗、内存使用情况、CPU 占用量、网络使用量等数据。这不仅能使开发人员对 Pioneer 进行更细致的优化，同时向公众公开测试数据，以提高对 Pioneer for iOS 的信任。

​	实验时，在正常的工作模式下使用 Xcode 等工具测试设备 iPhoneXS 的各项测试标准，同时周围共构建 10 台 Android 设备和 iOS 设备以模拟正常的交互场景。



#### 功耗报告

基于低功耗蓝牙（BLE）的技术，Pioneer for iOS 最主要的测试标准之一是有关功耗的问题。

![image-20241230151701029](https://cdn.jsdelivr.net/gh/lunan0320/pics@main/images/202412202412301517213.png)

​	应用在前台时，主要的耗电量来自于 Display，而 CPU 耗电却较少。当应用在后台时，耗电量也是低的，即无论是前台还是后台 Pioneer foriOS 的耗电等级就系统评估来讲都是 Low 级别的，这正与 Pioneer 的设计初衷相符。

​	此外，当开启了位置传感器这一 Pioneer 可选功能时，前台和后台的耗电量都将因为位置传感器的持续工作而增大（这并没有暴露用户隐私），这对于某些人群来说可能使无法接受的，因此 Pioneer 将这一功能设置为可选功能并在持续进行优化，尽量使耗电量更少。

#### CPU 报告

![image-20241230151900661](https://cdn.jsdelivr.net/gh/lunan0320/Pioneer@main/images/202412301529373.png)

​	正常工作模式下，Pioneer 的 CPU 占用率非常低，而且对 CPU 的占用并不是连续的。测试中 Pioneer 的 CPU 占用峰值为 13%，但通常平均占用一般是 2～6%。

![image-20241230153003325](https://cdn.jsdelivr.net/gh/lunan0320/Pioneer@main/images/202412301530407.png)

​	Pioneer for iOS 对网络的使用主要是与 Pioneer 服务器建立连接并交互信息，但这并不是频繁的，换句话说 Pioneer 应用只会定期（至少每天一次）与服务器建立连接并交互信息：

#### 用户注册

​	用户注册需要与服务器连接并注册信息，上面给出了用户注册时的网络使用情况。用户的注册只在应用首次使用时才进行，也就是说这种连接在整个应用生命周期内只出现一次。

#### 感染者信息下载

​	另一个最主要的功能就是 Pioneer 定期从服务器下载感染者信息，此时网络的使用量就不再是固定统一的了，因为这与服务器中感染者的安全身份信息量有关。

#### 上传自身安全信息

​	当用户被确诊后或者在 Pioneer 内部的安全检测中被检测出与风险者有过接触而成为风险者后，Pioneer 将上传用户的近 14 天安全身份信息至 Pioneer 服务器，此时与服务器进行的网络交互数据量是固定的。

​	总地来说，Pioneer for iOS 在正常的用户身份信息交互阶段并不使用网络，而仅仅在与 Pioneer 服务器交互安全数据时才使用网络，并且这是少量的。

#### 内存报告

![image-20241230153626482](https://cdn.jsdelivr.net/gh/lunan0320/Pioneer@main/images/202412301536567.png)

​	在测试期间内，Pioneer for iOS 的内存使用如上图所示，内存使用峰值可达 44.6MB，相对于系统来说仅占用了 1.2%，这是比较低的。经过多次测试（包括变换环境）发现应用对内存的使用均是较低的，这正符合我们的预期。

#### 后台可持续运行

![image-20241230153735882](https://cdn.jsdelivr.net/gh/lunan0320/Pioneer@main/images/202412301537019.png)

​	实验测试使用标准设备（iPhone XS）进行测试，给出以上连续 8 个小时以上的测试数据。可以看到，Pioneer for iOS 在全部的 8 小时之内休眠时间仅占了 20 分钟，即 Pioneer 可以在后台达到 96% 的持续运行并且保证不被系统管理自动杀死，实际上这在正常的模拟使用环境中是可以达到较好的效果的。

#### 适用范围

在 Pioneer 开发中，已经尽量采用各种技术降低对部署设备的要求：

（1）用户身份信息的交互通过读写固定特征来实现，这给那些无法使用广播的设备（如三星 J6 等）提供了正常工作的机会。

（2）代码开发中不使用第三方库而使用系统推荐的库并且在保证安全性的前提下尽量使用对系统版本要求底的内置库。但是，基于 Pioneer中对 Network 库的使用以保证安全的 TLS 连接，Pioneer for iOS 对系统的要求最低为 iOS12.1。

​	从上面的数据可以看到，当今 iPhone 设备中系统版本在 iOS 12 以上的设备占有率至少可以达到 94%，因此 Pioneer for iOS 的至少可支持当前市场 iPhone 设备中近 94% 的设备。对于 iOS-iOS，Pioneer 可达到 94% × 94% = 88.36% 的部署覆盖率。



### Pioneer for Android 测试

​	Pioneer for Android 的目的是设计出耗电量低、CPU 占用低、存储占用低的能够在后台持续运行的、适用范围广的联系人跟踪应用。该测试模块基于 Pioneer for Android 在 HUAWEI-P40 ELS-AN00 以及 HUAWEI nova5 pro SEA-AL10 上的测试数据，给出 Pioneer 应用在正常的工作模式下的功耗、内存使用情况、CPU 占用量、网络使用量等数据。给出上述的测试分析，有助于我们后续对应用的优化，以及去判断应用的普适性，提高开发者对 Pioneer 的信任。

​	实验时，在正常的工作模式下，我们采取 HUAWEI 手机系统的方式来测试能耗信息，利用腾讯 WeTest 平台下的 Perfdog 工具对相应数据进行测试分析，同时周围共构建 10 台 Android 设备和 iOS 设备以模拟正常的交互场景。

#### 功耗报告

​	基于低功耗蓝牙（BLE）的技术，Pioneer for Android 最主要考虑的问题便是能耗问题，我们基于系统后台的电量测试给出相应的分析。

测试设备：华为 P40 Pro

测试环境：测试手机蓝牙能够探测到的范围内有 20 个左右蓝牙外设，其中安装本 app 的有 8 台设备。

测试时间：10 小时

具体数据如下图所示

![image-20241230154047224](https://cdn.jsdelivr.net/gh/lunan0320/Pioneer@main/images/202412301540308.png)

​	应用在前台运行时，其电量消耗主要是因为 UI 展示和数据的更新，后台能耗主要是消耗在定时的广播、扫描与连接和定时的网络任务，经过我们的测试，前台每小时耗电量约为 100mAh，在手机中的耗电比重大概每小时 2.5%，APP 在后台运行总时长为 10 小时 18 分 48 秒，耗电量为 474.28mAh，平均每小时耗电量为 46mAh，在手机中的耗电比重大概为1%，实现了低能耗的设计初衷。